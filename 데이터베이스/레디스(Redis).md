# Redis

key, value 구조의 비정형 데이터를 저장하고 관리하기 위한 오픈 소스 기반의 비관계형 데이터 베이스 관리 시스템 (DBMS)  
캐싱도 가능해 실시간 채팅에 적합하며 세션 공유를 위해 세션 클러스터링에도 활용된다.

</br>

## 캐시 서버(Cache Server)

캐시는 한번 읽어온 데이터를 임의의 공간에 저장하여 다음에 읽을 때는 빠르게 결과값을 받을 수 있도록 도와주는 서버이다.  
같은 요청이 여러 번 들어오는 경우 매번 데이터 베이스를 거치는 것이 아닌 첫 번째 요청 이후 캐시 서버에서 저장된 결과를 바로 내려주기 때문에 DB의 부하를 줄이고 서비스의 속도를 향상 시킨다.

이런 캐시 서버로 이용 할 수 있는 저장소가 Redis이다.

캐시 서버는 Look aside cache 패턴과 Write Back 패턴이 존재한다.

</br>

### Look aside cache

1. 클라이언트가 데이터를 요청
2. 웹서버는 데이터가 존재하는지 Cache 서버에 먼저 확인
3. Cache 서버에 데이터가 있으면 DB에 데이터를 조회하지 않고 Cache 서버에 있는 결과값을 클라이언트에게 바로 반환 (Cache Hit)
4. Cache 서버에 데이터가 없으면 DB에 데이터를 조회하여 Cache 서버에 저장하고 결과값을 클라이언트에게 반환 (Cache Miss)

</br>

### Write Back

1. 웹서버는 모든 데이터를 Cache 서버에 저장
2. Cache 서버에 특정 시간 동안 데이터가 저장됨
3. Cache 서버에 있는 데이터를 DB에 저장
4. DB에 저장된 Cache 서버의 데이터를 삭제

</br>

## Redis의 특징

- Key, Value 구조이기 때문에 쿼리를 사용할 필요가 없다.
- 데이터를 디스크에 쓰는 구조가 아니라 메모리에서 데이터를 처리하기 때문에 속도가 빠릅니다.
- 다양한 자료 구조를 지원합니다.

  - String : 가장 일반적인 key - value 구조의 형태.
  - Set : String의 집합입니다. 여러 개의 값을 하나의 value에 넣을 수 있다. 포스트의 태그 같은 곳에 사용될 수 있다.
  - Sorted Set : 중복된 데이터를 담지 않는 Set 구조에 정렬을 적용한 구조. 랭킹 보드 같은 구현에 사용할 수 있다.
  - List : Array 형식의 데이터 구조. List를 사용하면 처음과 끝에 데이터를 넣고 빼는 건 빠르지만 중간에 데이터를 삽입하거나 삭제하는 것은 어렵다.
  - Hash

- Single Threaded 입니다.
  - 한 번에 하나의 명령만 처리할 수 있습니다. 그렇기 때문에 중간에 처리 시간이 긴 명령어가 들어오면 그 뒤에 명령어들은 모두 앞에 있는 명령어가 처리될 때까지 대기가 필요합니다.  
    (하지만 get, set 명령어의 경우 초당 10만 개 이상 처리할 수 있을 만큼 빠릅니다.)

</br>

## 주의할 점

- 서버에 장애가 발생했을 경우 그에 대한 운영 플랜이 필요하다.  
   : 인메모리 데이터 저장소의 특성상, 서버에 장애가 발생했을 경우 데이터 유실이 발생할 수 있다.
  - snapshot : 특정 지점을 설정하고 디스크에 백업.
  - AOF(Append Only File) : 명령(쿼리)들을 저장해두고, 서버가 셧다운되면 재실행해서 다시 만들어 놓는 것
- 메모리 관리가 중요하다.
- 싱글 스레드이기 때문에 처리하는데 시간이 오래 걸리는 요청, 명령은 피해야 한다.

</br>

## Publish / Subscribe

특정한 주제(topic)에 대하여 해당 topic을 구독한 모두에게 메세지를 발행하는 통신 방법으로 채널을 구독한 수신자(클라이언트) 모두에게 메세지를 전송 하는것.  
주로 채팅 기능이나, 푸시 알림등에 사용된다.

redis의 pub/sub 시스템은 매우 단순한 구조로 되어있다.  
publisher가 subscriber에게 메세지를 전달하지만 던지는 구조이기 때문에 메세지를 따로 보관하지 않고 메세지의 수신이 보장되지 않는다.

하지만 웹소켓을 이용하는 경우에는 네트워크 통신이 필요하기에 레이턴시(딜레이)가 약간 생기는데 비해 redis는 In-Memory 기반이라 매우 빠르게 메세지를 받을 수 있다.
